{% extends 'layout_main.html.twig' %}
{% block title %}Modification  mesure
	{% endblock %}
{% block content %}
<section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Modification  mesure</h1>
             {% if classe is defined %}
			<div class="{{classe}}">{{resultat}}</div>
		{% endif %}
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
             </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>
	    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
     <div class="row">
          <div class="col-12">

            <div class="card">
              <div class="card-header">
                
              </div>


        <h6 class="font-weight-bolder mb-0">Mesure de Mr/Mm/Mlle :{% if  mesure.user %}{{ mesure.user.firstname |capitaize_first}} {{ mesure.user.lastname |capitaize_first}}  {% else %} {% endif %}</h6>
    </div>
</nav>
<div class="container form-section">
{% for type, messages in app.session.flashBag.all %}
      {% for message in messages %}
        {% if type == 'error' %}{% set type = 'danger' %}{% endif %}
        {% if type == 'success' %}{% set type = 'success' %}{% endif %}
        <div class="alert alert-{{ type }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert">
            <span>&times;</span>
          </button>
        </div>
      {% endfor %}
    {% endfor %}
    <div class="row">
        <div class="col-md-8">
            
  <h3>Formulaire dde modification</h3>
  <form method="post">
    {{ form_start(form) }}

    <div class="row">
      <div class="col-md-6">
        <h5>Modifiez les mesures du haut</h5>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.epaule, 'Epaule (cm)') }}
              {{ form_widget(form.epaule, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.poitrine, 'Poitrine (cm)') }}
              {{ form_widget(form.poitrine, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.manche, 'Manche (cm)') }}
              {{ form_widget(form.manche, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.encolure, 'Encolure (cm)') }}
              {{ form_widget(form.encolure, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
        </div>
        <div class="row">
         <div class="col-md-6">
          <div class="form-group">
            {{ form_label(form.poignee, 'Poignée (cm)') }}
            {{ form_widget(form.poignee, {'attr': {'class': 'form-control'}}) }}
          </div>
         </div>
         <div class="col-md-6">
          <div class="form-group">
            {{ form_label(form.ecartDos, 'Écart Dos (cm)') }}
            {{ form_widget(form.ecartDos, {'attr': {'class': 'form-control'}}) }}
          </div>
         </div>
        </div>
        <div class="row">
         <div class="col-md-6">
          <div class="form-group">
          {{ form_label(form.tourVentrale, 'Tour ventrale (cm)') }}
          {{ form_widget(form.tourVentrale, {'attr': {'class': 'form-control'}}) }}
          </div>
         </div>
         <div class="col-md-6">
          <div class="form-group">
            {{ form_label(form.longueur, 'Longueur chemise (cm)') }}
            {{ form_widget(form.longueur, {'attr': {'class': 'form-control'}}) }}
          </div>
         </div>
        </div>
      </div>

      <div class="col-md-6">
        <h5>Modifiez les mesures du bas</h5>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.ceinture, 'Ceinture (cm)') }}
              {{ form_widget(form.ceinture, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.taille, 'Taille (cm)') }}
              {{ form_widget(form.taille, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
        </div>
      <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.fermeture, 'Fermeture (cm)') }}
              {{ form_widget(form.fermeture, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
                {{ form_label(form.cuisse, 'Cuisse (cm)') }}
                {{ form_widget(form.cuisse, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.longueurPantalon, 'Longueur Pantalon (cm)') }}
              {{ form_widget(form.longueurPantalon, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              {{ form_label(form.basPantalon, 'Bas Pantalon (cm)') }}
              {{ form_widget(form.basPantalon, {'attr': {'class': 'form-control'}}) }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <button type="submit" class="btn btn-primary" style="margin-right:15px">Enregistrer</button>
      <i class="fa fa-ban">
        <a href="{{ path('list_mesure') }}"><strong>Annuler</strong></a>
      </i>
    </div>

    {{ form_end(form) }}
  </form>
</div>

<script>
  document.querySelector('form').addEventListener('submit', function (event) {
    const pretFields = document.querySelectorAll('[name="champPret"]');
    const mesureFields = document.querySelectorAll('[name="champMesure"]');
    const regex = /^([0-9](\.\d{2})?|9\.99)$/; // Accepte de 0.01 à 9.99 avec deux décimales

    let isValid = true;
    [...pretFields, ...mesureFields].forEach(field => {
      if (!regex.test(field.value)) {
        alert("Veuillez entrer une valeur valide entre 0.01 et 9.99 (précision : 10^-2).");
        isValid = false;
      }
    });

    if (!isValid) {
      event.preventDefault(); // Annule la soumission du formulaire
    }
  });
</script>
{% endblock %}
{% block autresFichiersJs %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    const inputs = document.querySelectorAll(
        'input[name*="epaule"], input[name*="poitrine"], input[name*="manche"], input[name*="encolure"], ' +
        'input[name*="poignee"], input[name*="ecartDos"], input[name*="tourVentrale"], input[name*="longueur"], ' +
        'input[name*="ceinture"], input[name*="taille"], input[name*="fermeture"], input[name*="cuisse"], ' +
        'input[name*="longueurPantalon"], input[name*="basPantalon"]'
    );

    inputs.forEach(function(input) {

        // ✅ Clavier numérique mobile
        input.setAttribute("inputmode", "decimal");
        input.setAttribute("pattern", "[0-9]+(\\.[0-9]{1,2})?");
        input.setAttribute("placeholder", "Max: 9.99");

        input.addEventListener("input", function () {

            // ✅ Supprime tout sauf chiffres et point
            this.value = this.value.replace(/[^0-9.]/g, '');

            // ✅ Empêche plusieurs points
            if ((this.value.match(/\./g) || []).length > 1) {
                this.value = this.value.slice(0, -1);
            }

            // ✅ Conversion en nombre
            let valeur = parseFloat(this.value);

            // ✅ Limite max = 9.99
            if (valeur > 9.99) {
                this.value = "9.99";
                this.style.border = "2px solid red";

                // ✅ Alerte utilisateur
                if (!this.dataset.alerted) {
                    alert("⛔ La valeur ne doit pas dépasser 9.99");
                    this.dataset.alerted = "true";
                }
            } else {
                this.style.border = "1px solid #ced4da";
                this.dataset.alerted = "";
            }

        });

    });

});
</script>
{% endblock %}