  {% extends 'layout_main.html.twig' %}
{% block title %}Liste commandes
	{% endblock %}
{% block autresfichierscss %}
 
{% endblock %}
{% block content %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Liste commandes</h1>
             {% if classe is defined %}
			<div class="{{classe}}">{{resultat}}</div>
		{% endif %}
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Tableau de liste des commandes</h3>
				          <div class="card-tools">
                  <div class="input-group input-group-sm">
                   <a href="{{ path('ajout_commande') }}" class="btn btn-success btn-sm ml-3">
										<i class="fa fa-plus"></i>
										Nouvelle commande
									</a>
					        </div></div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <table id="commande" class="table table-bordered table-striped">
                  <thead>
                    <tr>
                     <th>N° commande</th>
                      <th>commande</th>
                      <th>type commandes</th>
                      <th>Date commandes</th>
                      <th>Date recuperations</th>
                      <th>Montants</th>
                      <th>Avances</th>
                      <th>Restes</th>
                      <th>Statut</th>
                      <th>Nom tailleurs</th>
                      <th>Modele</th>
                      <th>Tissus</th>
                      <th>Payer le reste</th>
                      <th>Affectation</th>
                      <th>Terminer</th>
                      <th>Recuperation</th>
                       <th>Reçu </th>
                       <th>Action </th>
							      </tr>
				          </thead>
                  <tbody>
                  {% block alerts %}
  {% for type, messages in app.session.flashBag.all %}
    {% for message in messages %}
        {%if type == 'error'%} {% set type = 'danger' %} {%endif%}
        {%if type == 'message'%} {% set type = 'info' %} {%endif%}
        <div class="alert alert-{{ type }} alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>
            </button>
            <p>{{ message|raw }}</p>
        </div>
    {% endfor %}
  {% endfor %}
                 {% endblock %}
                  {% for commande in commandes %}
                    <tr>
                    <td><strong>C-00000{{ commande.id }}</strong></td>
                     <td>{% if  commande.user %}
                      {{ commande.user.firstName |capitaize_first}} {{ commande.user.lastName |capitaize_first }}
                      
                      {% else %}
                      
                      {% endif %}
                      </td>
                      <td>{{ commande.typeCom }}</td>
                      <td>{{ commande.datCom |date('Y-m-d')}}</td>
                      <td><strong>{{ commande.datRec |date('Y-m-d')}}</strong></td>
                      <td style="color:blue"><strong>{{ commande.montant|number_format(0, '.', ' ') }} FCFA</strong></td>
                      <td><strong>{{ commande.avance|number_format(0, '.', ' ') }} FCFA</strong></td>
                      <td style="color:red"><strong>{{ commande.reste|number_format(0, '.', ' ') }} FCFA</strong></td>
                      <td style="color:green"><strong>{{ commande.statut }}</strong></td>
                     <td>{% if  commande.usert %}
                      {{ commande.usert.firstName |capitaize_first }} {{ commande.usert.lastName |capitaize_first}}
                      
                      {% else %}
                      
                      {% endif %}
                      
                      </td>
                          <td>
                            {% if  commande.pathMod is not empty %}
                            
                              <div class="file-list">
                                {% for path in commande.pathMod %}
                                  <div  class="file-item">
                                    <a class="btn-outline-success " style="color: black; margin-button: -10px" 
                                    href="{{ asset(path) }}" onclick="return confirm('Voulez-vous voir le modèle ?')">
                                      <p>Modéle {{loop.index}}</p>
                                    </a>
                                  </div>
                                {% endfor %}
                              </div>
                            {% else %}
                                <p>Pas de modéle</p>
                            {% endif %}
                          </td>
                          <td>
                            {% if  commande.pathTissu is not empty %}
                              <div class="file-list"> 
                                {% for path in commande.pathTissu %}
                                  <div  class="file-item">
                                    <a class=" btn-outline-success " style="color: black; margin-button: -10px" href="{{ asset(path) }}" onclick="return confirm('Voulez-vous voir le tissu ?')">
                                        <p>Tissu {{loop.index}}</p>
                                    </a>
                                  </div>
                                {% endfor %}
                              </div>
                            {% else %}
                              <p>Pas de tissu</p>
                            {% endif %}
                          </td>
                        <td> {% if  commande.reste > 0 %}
                          <a class="btn btn-sm btn-outline-success"style="color: blue; border-color: blue;"  href={{ path('cmd_reliquat', {id: commande.id}) }} onclick="return confirm('reglement du reste à payer ?')">
                                <i class="bi-check"></i>
                                <span class="sr-only">Reliquat</span>
                            </a> 
                            {% endif %}
                             </td>
                             <td>
                            {% if commande.usert is null %}
                              <button type="button"
                                      class="btn btn-sm btn-outline-success open-modal"
                                      style="color: blue; border-color: blue;"
                                      data-toggle="modal"
                                      data-target="#tailleurModal"
                                      data-url="{{ path('cmd_affectation', {id: commande.id}) }}">
                                  <i class="bi-check"></i>
                                  <span class="sr-only">Affectation</span>
                              </button>
                            {% endif %}
                          </td>
                             <td>{% if  commande.statut == 'Encours' %}
                      <a class="btn btn-sm btn-outline-success"style="color: blue; border-color: blue;"  href="{{ path('commande_terminer', {id: commande.id}) }}" onclick="return confirm('Avez vous finaliser la commande ?')">
                              <i class="bi-check"></i>
                              <span class="sr-only">Terminer</span>
                          </a>   
                            {% endif %}
                              </td>
                               <td>{% if  commande.statut == 'Terminer' %}
                      <a  href="{{ path('commande_recuperer', {id: commande.id}) }}" class="btn btn-sm btn-outline-success"style="color: blue; border-color: blue;" onclick="return confirm('voulez vous confirmer la recuperation ?')">
                              <i class="bi-check"></i>
                              <span class="sr-only">Reception</span>
                          </a>    
                          {% endif %} 
                              </td> 
                            <td> 
                            <a class="btn btn-sm btn-outline-success"style="color: blue; border-color: blue;" href="{{ path('faire_recu', {id: commande.id}) }}" onclick="return confirm('Voulez-vous effectuer le recu pour cette commande ?')">
                                  <i class="bi bi-print">Réçu</i>
                                  <span class="sr-only">Réçu</span>
                              </a> 
                            </td>       
                         {# {%if is_granted(role_admin) %} #}
                       
                      <td><a class="btn btn-info btn-sm" href="{{ path('edit_commande', {id: commande.id}) }}" onclick="return confirm('Etes-vous sûr de vouloir modifier cet commande ?')">
                              <i class="fa fa-edit"></i>
                              <span class="sr-only">Editer</span>
                          </a> 
									      <a class="btn btn-danger btn-sm" href="{{ path('delete_commande', {'id': commande.id}) }}" onclick="return confirm('Etes-vous sûr de vouloir supprimé ce rendez-vous ?')">
                              <i class="fa fa-trash"></i>
                              <span class="sr-only">delete</span>
                          </a> 
                          
									      </td>
                        {# {% endif %} #}
								    </tr>
						      	{% endfor %}
                  </tbody>
                  <tfoot>
                    <tr>
                     <th>N° commande</th>
                      <th>commande</th>
                      <th>type commandes</th>
                      <th>Date commandes</th>
                      <th>Date recuperations</th>
                      <th>Montants</th>
                      <th>Avances</th>
                      <th>Restes</th>
                      <th>Statut</th>
                      <th>Nom tailleurs</th>
                      <th>Modele</th>
                      <th>Tissus</th>
                      <th>Payer le reste</th>
                      <th>Affectation</th>
                      <th>Terminer</th>
                      <th>Recuperation</th>
                       <th>Reçu </th>
                       <th>Action </th>
                    </tr>
                  </tfoot>
                </table>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
            
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
    
<!-- Modal -->
<div class="modal fade" id="tailleurModal" tabindex="-1" role="dialog" aria-labelledby="tailleurModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Affecter un tailleur</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Fermer">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="modal-body-content">
        <!-- Le formulaire sera chargé ici via AJAX -->
        <div class="text-center">
            <div class="spinner-border" role="status">
              <span class="sr-only">Chargement...</span>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>

  {% endblock %}
{% block autresFichiersJs %}
<!-- jQuery -->
<script src="{{ asset('plugins/jquery/jquery.min.js') }}"></script>
<!-- Bootstrap 4 -->
<script src="{{ asset('plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
<!-- DataTables  & Plugins -->
<script src="{{ asset('plugins/datatables/jquery.dataTables.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-bs4/js/dataTables.bootstrap4.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-responsive/js/dataTables.responsive.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-responsive/js/responsive.bootstrap4.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-buttons/js/dataTables.buttons.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-buttons/js/buttons.bootstrap4.min.js') }}"></script>
<script src="{{ asset('plugins/jszip/jszip.min.js') }}"></script>
<script src="{{ asset('plugins/pdfmake/pdfmake.min.js') }}"></script>
<script src="{{ asset('plugins/pdfmake/vfs_fonts.js') }}"></script>
<script src="{{ asset('plugins/datatables-buttons/js/buttons.html5.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-buttons/js/buttons.print.min.js') }}"></script>
<script src="{{ asset('plugins/datatables-buttons/js/buttons.colVis.min.js') }}"></script>
<!-- AdminLTE App -->
<script src="{{ asset('dist/js/adminlte.min.js') }}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{{ asset('dist/js/demo.js') }}"></script>
<!-- Page specific script -->
<script>
  $(function () {
    $("#commande").DataTable({
      "responsive": true,"aaSorting": [[0, "desc"]],oLanguage: {
sSearch: "Rechercher : ",
sZeroRecords: "Aucune valeur trouvée",
sInfo: "Afficher page _PAGE_ sur _PAGES_",
sInfoFiltered: "(Filtres sur _MAX_ )",
sInfoEmpty: "",
oPaginate: {
sFirst: "Premier",
sPrevious: "Pr&eacute;c&eacute;dent",
sNext: "Suivant",
sLast: "Dernier"
}
}, "lengthChange": false, "autoWidth": false,
      "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
    }).buttons().container().appendTo('#commande_wrapper .col-md-6:eq(0)');
    
  });
</script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    $(document).ready(function () {
        $('.open-modal').click(function () {
            let url = $(this).data('url');

            // Charger le contenu du formulaire dans la modale
            $('#modal-body-content').load(url);
        });
    });
</script>

  {% endblock %}



