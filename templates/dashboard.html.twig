{% extends 'layout_main.html.twig' %}
{% block content %}

<nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" data-scroll="true">
  <div class="container-fluid py-1 px-3">
    <nav aria-label="breadcrumb">
      <h6 class="font-weight-bolder mb-0">
        <img src="{{ asset('assets/img/Logo2.png') }}" alt="Logo" class="img-fluid" style="max-width: 100px;">
        &nbsp;&nbsp;IDMTechWorks Dashboard
      </h6>
    </nav>
  </div>
</nav>

<br>

<section class="content-header">
  <div class="row">

    {# Bloc filtré selon le rôle #}
    {% if is_granted('ROLE_TAILLEUR') %}
        <!-- Non démarré (tailleur) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-info">
            <div class="inner">
              <h3>{{ response|number_format }}</h3>
              <h5 class="pl-2">Non démarré</h5>
            </div>
            <div class="icon">
              <i class="fa fa-building"></i>
            </div>
            <a href="{{ path('cmd_aff_NonDem', {'tailleur': app.user.id}) }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
        <!-- Encours (tailleur) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-warning">
            <div class="inner">
              <h3>{{ result1|number_format }}</h3>
              <h5 class="pl-2">En cours</h5>
            </div>
            <div class="icon">
              <i class="fa fa-building"></i>
            </div>
            <a href="{{ path('cmd_aff_Encours', {'tailleur': app.user.id}) }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
        <!-- Terminé (tailleur) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-success">
            <div class="inner">
              <h3>{{ result2|number_format }}</h3>
              <h5 class="pl-2">Terminé</h5>
            </div>
            <div class="icon"><i class="fa fa-building"></i></div>
            <a href="{{ path('cmd_aff_Terminer', {'tailleur': app.user.id}) }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
        <!-- Livré (tailleur) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-primary">
            <div class="inner">
              <h3>{{ result3|number_format }}</h3>
              <h5 class="pl-2">Livré</h5>
            </div>
            <div class="icon"><i class="fa fa-building"></i></div>
            <a href="{{ path('cmd_aff_Livrer', {'tailleur': app.user.id}) }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
    {% else %}
        <!-- Non démarré (admin/super) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-info">
            <div class="inner">
              <h3>{{ render(controller('App\\Controller\\CommandeController::getCommandeAllStatut')) |number_format }}</h3>
              <h5 class="pl-2">Non démarré</h5>
            </div>
            <div class="icon">
              <i class="fa fa-building"></i>
            </div>
            <a href="{{ path('cmd_aff_NonDem') }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
        <!-- Encours (admin/super) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-warning">
            <div class="inner">
              <h3>{{ render(controller('App\\Controller\\CommandeController::getCommande1AllStatut')) |number_format }}</h3>
              <h5 class="pl-2">En cours</h5>
            </div>
            <div class="icon">
              <i class="fa fa-building"></i>
            </div>
            <a href="{{ path('cmd_aff_Encours') }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
        <!-- Terminé (admin/super) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-success">
            <div class="inner">
              <h3>{{ render(controller('App\\Controller\\CommandeController::getCommande2AllStatut')) |number_format }}</h3>
              <h5 class="pl-2">Terminé</h5>
            </div>
            <div class="icon"><i class="fa fa-building"></i></div>
            <a href="{{ path('cmd_aff_Terminer') }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
        <!-- Livré (admin/super) -->
        <div class="col-lg-3 col-xs-6">
          <div class="small-box bg-primary">
            <div class="inner">
              <h3>{{ render(controller('App\\Controller\\CommandeController::getCommande3AllStatut')) |number_format }}</h3>
              <h5 class="pl-2">Livré</h5>
            </div>
            <div class="icon"><i class="fa fa-building"></i></div>
            <a href="{{ path('cmd_aff_Livrer') }}" class="small-box-footer">
              voir plus <i class="fa fa-arrow-circle-right"></i>
            </a>
          </div>
        </div>
    {% endif %}

  </div>

   <br>

  <!-- Graphiques -->
  <div class="content">
    <div class="container-fluid">
      <div class="row">


        <!-- Histogramme des commandes -->
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header border-0 d-flex justify-content-between">
              <h3 class="card-title">Histogramme des commandes</h3>
              <a href="#">Rapports statistiques du mois</a>
            </div>
            <div class="card-body">
              <div class="position-relative mb-4" style="min-height:350px;">
                <canvas id="sales-chart" style="width:100%;height:320px;min-height:320px" height="320"></canvas>
              </div>
              <div class="text-center mt-2">
                <span class="badge bg-info">Non démarré</span>
                <span class="badge bg-warning">En cours</span>
                <span class="badge bg-success">Terminé</span>
                <span class="badge bg-primary">Livré</span>
              </div>
            </div>
          </div>
        </div>


        <!-- Statistiques mensuelles -->
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header border-0">
              <h3 class="card-title">Commandes du Mois Actuel</h3>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center border-bottom mb-3 btn btn-info">
                <p class="text-xl"><i class="ion ion-ios-refresh-empty"></i></p>
                <p class="d-flex flex-column text-right">
                  <span class="font-weight-bold">{{ response }} Commandes non démarrées</span>
                </p>
              </div>
              <div class="d-flex justify-content-between align-items-center border-bottom mb-3 btn btn-warning">
                <p class="text-xl"><i class="ion ion-ios-refresh-empty"></i></p>
                <p class="d-flex flex-column text-right">
                  <span class="font-weight-bold">{{ result1 }} Commandes en cours</span>
                </p>
              </div>
              <div class="d-flex justify-content-between align-items-center border-bottom mb-3 btn btn-success">
                <p class="text-xl"><i class="ion ion-ios-cart-outline"></i></p>
                <p class="d-flex flex-column text-right">
                  <span class="font-weight-bold">{{ result2 }} Commandes terminées</span>
                </p>
              </div>
              <div class="d-flex justify-content-between align-items-center btn btn-primary">
                <p class="text-xl"><i class="ion ion-ios-people-outline"></i></p>
                <p class="d-flex flex-column text-right">
                  <span class="font-weight-bold">{{ result3 }} Commandes livrées</span>
                </p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

</section>


<!-- Scripts -->
<script src="{{ asset('plugins/jquery/jquery.min.js') }}"></script>
<script src="{{ asset('plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>




<script>
document.addEventListener("DOMContentLoaded", function () {

    const labels = ['Non démarré', 'En cours', 'Terminé', 'Livré'];
    const counts = [
        {{ response }},
        {{ result1 }},
        {{ result2 }},
        {{ result3 }}
    ];

    /* =========================
       BAR CHART (Histogramme)
    ========================== */
    const salesCtx = document.getElementById('sales-chart');
    if (salesCtx) {
        new Chart(salesCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Nombre de commandes',
                    data: counts,
                    backgroundColor: ['#17a2b8','#ffc107','#28a745','#007bff']
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });
    }

    /* =========================
       LINE CHART (Courbe)
    ========================== */
    const visitorsCtx = document.getElementById('visitors-chart');
    if (visitorsCtx) {
        new Chart(visitorsCtx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Évolution des commandes',
                    data: counts,
                    borderColor: '#007bff',
                    backgroundColor: 'transparent',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true
            }
        });
    }

});
</script>


{% endblock %}
